# Log Processor
## 项目简介
Log Processor是一个高效的日志流量监测和分析工具，旨在处理和分析来自web服务器的日志数据。通过 Grafana 与 InfluxDB 集成，实现日志数据的可视化展示，帮助用户直观地了解系统的运行情况和日志流量。

## 安装
**克隆仓库**<br>
git clone https://github.com/lzw734/LogProcessor.git<br>
**包管理**<br>
go mod tidy<br>
**配置**<br>
在项目根目录下，你可以使用命令行参数来配置日志文件路径和 InfluxDB 连接信息：<br>
-path：指定日志文件的路径。<br>
-dsn：指定 InfluxDB 的连接信息。<br>
**示例**<br>
    ```
  go run LogProcessor.go -path /var/log/nginx/access.log -dsn http://localhost:8086@username@password@dbname@s
    ```

## 模块分类
1. 日志读取模块 (ReadFromFile)<br>
功能：从指定的日志文件中读取数据行。使用 bufio 逐行读取日志文件内容，文件读取到末尾时，程序会定时等待新日志的写入。<br>
关键点：文件读取操作会持续执行，并且使用通道 (channel) 将读取到的数据传递给后续的处理模块。
2. 日志处理模块 (logProcess)<br>
功能：解析日志内容，将其转换为结构化的数据格式。使用正则表达式提取日志中的关键字段，如时间、请求方法、状态码、字节数等。<br>
关键点：处理时，会检查日志格式的正确性，对无效日志行进行错误处理。处理完的数据通过通道传递给写入模块。<br>
3. 数据写入模块 (WriteToInfluxdb)<br>
功能：将处理后的日志数据写入 InfluxDB 数据库。通过 InfluxDB 客户端，创建批量数据点并写入数据库。<br>
关键点：通过将日志中的请求路径、方法、状态等信息作为标签，将数据存入时间序列数据库，便于后续的监控和查询。<br>
4. 监控模块 (Monitor)<br>
功能：实时监控系统的运行状态，包括日志处理行数、错误行数、吞吐量（TPS）、通道长度等，并通过 HTTP 接口对外暴露这些监控信息。<br>
关键点：使用定时器定期计算吞吐量，通过简单的 HTTP 服务器提供系统的实时监控数据。<br>

**客户端发送字节数流量图**
![alt text](<屏幕截图 2024-09-04 170704.png>)

**响应时间流量图**
![!\[alt text\](<屏幕截图 2024-09-04 170736.png>)](<屏幕截图 2024-09-04 170736_compressed.png>)

**上游服务器时间流量图**
![!\[alt text\](<屏幕截图 2024-09-04 170757.png>)](<屏幕截图 2024-09-04 170757_compressed.png>)

**监控模块图**
![!\[alt text\](<屏幕截图 2024-09-04 202657.png>)](<屏幕截图 2024-09-04 202657_compressed.png>)
**分析监控模块图发现该程序可以在1分钟多的时间处理1000多条日志，且writechanel为0说明没有数据堆积**

**项目学习总结**  
通过此项目，我学习到了GO的两大特性  
一、面向接口编程  
&nbsp;&nbsp;&nbsp;通过实现Reader接口和Writer接口把读写模块进行解耦，logprocess结构体不需要关心具体的读取和写入，只要依赖Reader接口和Writer接口即可，这样假如以后需要从其他日志读取数据，只需要实现对应的接口就行，不用改logProcess的核心逻辑。  
二、并发编程  
&nbsp;&nbsp;&nbsp;通过异步读取和处理日志数据，再加上基于通道的并发控制，可以较高效地处理大量日志数据。


